Code originally posted as an edit to this StackOverflow answer, to fill it out:
http://stackoverflow.com/a/20476577/733077
